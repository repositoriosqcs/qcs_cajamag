
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Bloque3/">
      
      
        <link rel="next" href="../Bloque4/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>3.1 FactTransaccionesVentas - Optimizaci贸n CAJAMAG - Gobierno de Datos</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="#d89717" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#31-fact-transacciones-ventas" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="Optimizaci贸n CAJAMAG - Gobierno de Datos" class="md-header__button md-logo" aria-label="Optimizaci贸n CAJAMAG - Gobierno de Datos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Optimizaci贸n CAJAMAG - Gobierno de Datos
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3.1 FactTransaccionesVentas
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="B煤squeda" placeholder="B煤squeda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando b煤squeda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegaci贸n" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Optimizaci贸n CAJAMAG - Gobierno de Datos" class="md-nav__button md-logo" aria-label="Optimizaci贸n CAJAMAG - Gobierno de Datos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Optimizaci贸n CAJAMAG - Gobierno de Datos
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    INTRODUCCIN
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../instalacion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    INSTALACIN Y CONFIGURACIN
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../buenaspracticas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BUENAS PRACTICAS
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../codigo/funciones/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FUNCIONES
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    BODEGAS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            BODEGAS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    1. Bodega 1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            1. Bodega 1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Bloque1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intoduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.1-DimDatosFijos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.1 DimDatosFijos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.2-DimCalendarioMensual/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.2 DimCalendarioMensual
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.3-Dimensiones/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.3 Dimensiones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.4-Dimensiones_xml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.4 Dimensiones xml
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.5-FactDatosContacto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.5 FactDatosContacto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.6-Fact_Historico_Afiliacion_Empresas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.6 Fact Historico Afiliacion Empresas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.7-Fact_Historico_Trabajadores1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.7 Fact Historico Trabajadores1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.7-Fact_Historico_Trabajadores2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.7 Fact Historico Trabajadores2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.8-Fact_HistoricoBeneficiarios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.8 Fact HistoricoBeneficiarios
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.9-Dim_Parametricas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.9 Dim Parametricas
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2. Bodega 2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            2. Bodega 2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Bloque2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intoduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.1-FactAportesEmpAfiliadas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.1 FactAportesEmpAfiliadas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.1-FactHistoricoAportesTotales/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.1 FactHistoricoAportesTotales
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.2-FactHistoricoCuota/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.2 FactHistoricoCuota
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.3-FactSubsidioVivienda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.3 FactSubsidioVivienda
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.4-FactFosfec/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.4 FactFosfec
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.2-FactEstadoGiroCuota/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.2 FactEstadoGiroCuota
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.5-Fact_HistoricoMoraEmp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.5 Fact HistoricoMoraEmp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.6-FactHistoricoANS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.6 FactHistoricoANS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.7-FactHistoricoSubPrescrito/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.7 FactHistoricoSubPrescrito
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.8-FactHistoricoRecobro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.8 FactHistoricoRecobro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.9-FactHistoricoRecuperado/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.9 FactHistoricoRecuperado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.10-FactIgestion_Mercurio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.10 FactIgestion Mercurio
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" checked>
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    3. Bodega 3
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            3. Bodega 3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Bloque3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intoduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    3.1 FactTransaccionesVentas
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    3.1 FactTransaccionesVentas
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduccion" class="md-nav__link">
    <span class="md-ellipsis">
      Introducci贸n
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introducci贸n">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diagrama-de-secuencia-del-proceso-etl" class="md-nav__link">
    <span class="md-ellipsis">
      Diagrama de Secuencia del Proceso ETL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#etl" class="md-nav__link">
    <span class="md-ellipsis">
      ETL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ETL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#importacion-de-librerias-y-funciones" class="md-nav__link">
    <span class="md-ellipsis">
      Importaci贸n de librer铆as y funciones
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracion-inicial-del-logger" class="md-nav__link">
    <span class="md-ellipsis">
      Configuraci贸n inicial del logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consulta-de-ventas-de-servicios-y-detalles-de-beneficiarios" class="md-nav__link">
    <span class="md-ellipsis">
      Consulta de Ventas de Servicios y Detalles de Beneficiarios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#carga-de-tablas-desde-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Carga de tablas desde SQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validacion-y-limpieza-de-datos-en-tablas-de-ventas-y-dimension-de-datos-fijos" class="md-nav__link">
    <span class="md-ellipsis">
      Validaci贸n y Limpieza de Datos en Tablas de Ventas y Dimensi贸n de Datos Fijos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conexion-a-la-base-de-datos-dwh-y-carga-de-tabla-de-datos-fijos" class="md-nav__link">
    <span class="md-ellipsis">
      Conexi贸n a la Base de Datos DWH y Carga de Tabla de Datos Fijos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eliminacion-de-duplicados-y-normalizacion-de-datos-en-ventas-de-servicios" class="md-nav__link">
    <span class="md-ellipsis">
      Eliminaci贸n de Duplicados y Normalizaci贸n de Datos en Ventas de Servicios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guardar-en-base-de-datos-dwh" class="md-nav__link">
    <span class="md-ellipsis">
      Guardar en base de datos DWH
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    4. Bodega 4
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            4. Bodega 4
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Bloque4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intoduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4.1-FactColegio_fijos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.1 FactColegio fijos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4.2-FactColegio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.2 FactColegio
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    5. Bodega 5
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            5. Bodega 5
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Bloque5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intoduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5.1-FactServicioSocial_Fijos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.1 FactServicioSocial Fijos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5.2-FactServicioSocial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.2 FactServicioSocial
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    6. Bodega 6
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            6. Bodega 6
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Bloque6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intoduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6.1-FactEncuestas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.1 FactEncuestas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6.2-Fact_Encuesta_afil_empleador/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.2 Fact Encuesta afil empleador
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduccion" class="md-nav__link">
    <span class="md-ellipsis">
      Introducci贸n
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introducci贸n">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diagrama-de-secuencia-del-proceso-etl" class="md-nav__link">
    <span class="md-ellipsis">
      Diagrama de Secuencia del Proceso ETL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#etl" class="md-nav__link">
    <span class="md-ellipsis">
      ETL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ETL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#importacion-de-librerias-y-funciones" class="md-nav__link">
    <span class="md-ellipsis">
      Importaci贸n de librer铆as y funciones
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracion-inicial-del-logger" class="md-nav__link">
    <span class="md-ellipsis">
      Configuraci贸n inicial del logger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consulta-de-ventas-de-servicios-y-detalles-de-beneficiarios" class="md-nav__link">
    <span class="md-ellipsis">
      Consulta de Ventas de Servicios y Detalles de Beneficiarios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#carga-de-tablas-desde-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Carga de tablas desde SQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validacion-y-limpieza-de-datos-en-tablas-de-ventas-y-dimension-de-datos-fijos" class="md-nav__link">
    <span class="md-ellipsis">
      Validaci贸n y Limpieza de Datos en Tablas de Ventas y Dimensi贸n de Datos Fijos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conexion-a-la-base-de-datos-dwh-y-carga-de-tabla-de-datos-fijos" class="md-nav__link">
    <span class="md-ellipsis">
      Conexi贸n a la Base de Datos DWH y Carga de Tabla de Datos Fijos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eliminacion-de-duplicados-y-normalizacion-de-datos-en-ventas-de-servicios" class="md-nav__link">
    <span class="md-ellipsis">
      Eliminaci贸n de Duplicados y Normalizaci贸n de Datos en Ventas de Servicios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guardar-en-base-de-datos-dwh" class="md-nav__link">
    <span class="md-ellipsis">
      Guardar en base de datos DWH
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="31-fact-transacciones-ventas">3.1 Fact Transacciones Ventas<a class="headerlink" href="#31-fact-transacciones-ventas" title="Permanent link">&para;</a></h1>
<h2 id="introduccion">Introducci贸n<a class="headerlink" href="#introduccion" title="Permanent link">&para;</a></h2>
<p>El proceso ETL para <code>FactTransaccionesVentas</code> unifica y transforma datos de ventas de servicios provenientes de m煤ltiples tablas (<code>servi21</code>, <code>servi20</code> y <code>servi03</code>) de la base de datos <code>servicios</code>, carg谩ndolos en una 煤nica tabla de ventas en el Data Warehouse (DWH). La extracci贸n de registros de venta est谩 limitada a los 煤ltimos 18 meses, asegurando que solo se procesen transacciones recientes. Se realizan transformaciones de datos, como la normalizaci贸n de valores faltantes y creaci贸n de claves 煤nicas de afiliados, que optimizan la estructura de los datos para an谩lisis posteriores. Finalmente, los datos se cargan en la tabla <code>BD_Fact_Ventas_Servicios</code> en el DWH, registrando cada etapa del proceso en un log para asegurar trazabilidad y control de calidad.</p>
<h3 id="diagrama-de-secuencia-del-proceso-etl">Diagrama de Secuencia del Proceso ETL<a class="headerlink" href="#diagrama-de-secuencia-del-proceso-etl" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    title Diagrama de Secuencia del Proceso ETL - FactTransaccionesVentas
    participant  Usuario
    participant ETL_Script
    participant Servicios_DB as Base de Datos Servicios
    participant DWH as Data Warehouse

     Usuario -&gt;&gt; ETL_Script: Ejecuta el script ETL
    ETL_Script -&gt;&gt; ETL_Script: Configura entorno y logger
    ETL_Script -&gt;&gt; Servicios_DB: Conecta a BD Servicios
    Servicios_DB --&gt;&gt; ETL_Script: Conexi贸n exitosa
    ETL_Script -&gt;&gt; Servicios_DB: Ejecuta consulta SQL para extraer ventas de servicios
    Servicios_DB --&gt;&gt; ETL_Script: Retorna datos de ventas de servicios
    ETL_Script -&gt;&gt; ETL_Script: Limpia, transforma y valida datos de ventas
    ETL_Script -&gt;&gt; DWH: Conecta a BD DWH
    DWH --&gt;&gt; ETL_Script: Conexi贸n exitosa
    ETL_Script -&gt;&gt; DWH: Carga datos en `BD_Fact_Ventas_Servicios`
    DWH --&gt;&gt; ETL_Script: Confirmaci贸n de carga exitosa
    ETL_Script -&gt;&gt;  Usuario: Finaliza proceso ETL y registra tiempo</code></pre>
<h2 id="etl">ETL<a class="headerlink" href="#etl" title="Permanent link">&para;</a></h2>
<h3 id="importacion-de-librerias-y-funciones">Importaci贸n de librer铆as y funciones<a class="headerlink" href="#importacion-de-librerias-y-funciones" title="Permanent link">&para;</a></h3>
<p>Este c贸digo configura el entorno para manipular y cargar datos en un Data Warehouse, importando librer铆as clave (<code>pandas</code>, <code>numpy</code>, <code>sqlalchemy</code>) y configurando el m贸dulo <code>Funciones.py</code> para ejecutar funciones personalizadas. Estas funciones permiten la normalizaci贸n de datos, carga en DWH, ejecuci贸n de consultas SQL, y manejo de registros de actividad, asegurando as铆 un flujo de trabajo completo para procesos ETL.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">sqlalchemy</span> <span class="k">as</span> <span class="nn">sa</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">Table</span><span class="p">,</span> <span class="n">insert</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="n">relativedelta</span>
<span class="c1">#---------------------------------------------</span>
<span class="c1">#Import de modulo funciones</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="c1"># Agrega el directorio al sys.path</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;../funciones&#39;</span><span class="p">))</span>
<span class="c1"># Importa las funciones desde el archivo Funciones.py</span>
<span class="kn">from</span> <span class="nn">Funciones</span> <span class="kn">import</span> <span class="n">StoreDuplicated</span><span class="p">,</span> <span class="n">obtener_conexion</span><span class="p">,</span> <span class="n">cargar_tablas</span><span class="p">,</span> <span class="n">testfunciones</span><span class="p">,</span> <span class="n">setup_logger</span><span class="p">,</span> <span class="n">guardar_en_dwh</span>
<span class="nb">print</span><span class="p">(</span><span class="n">testfunciones</span><span class="p">())</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Importacion de funciones correcta, 23-10-2024 17:47
</code></pre></div>

<h3 id="configuracion-inicial-del-logger">Configuraci贸n inicial del logger<a class="headerlink" href="#configuracion-inicial-del-logger" title="Permanent link">&para;</a></h3>
<p>Se configura el logger para registrar eventos del proceso ETL en el archivo <code>TransaccionesVentas.log</code>, utilizando el nivel de detalle <code>INFO</code>. Tambi茅n se registra el inicio del proceso, y se almacena la hora de inicio para medir el tiempo total de ejecuci贸n.</p>
<div class="highlight"><pre><span></span><code><span class="n">logger</span> <span class="o">=</span> <span class="n">setup_logger</span><span class="p">(</span><span class="n">log_filename</span><span class="o">=</span><span class="s1">&#39;TransaccionesVentas.log&#39;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;COMIENZO ETL&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-23 17:47:33,971 - INFO - COMIENZO ETL
</code></pre></div>

<h3 id="consulta-de-ventas-de-servicios-y-detalles-de-beneficiarios">Consulta de Ventas de Servicios y Detalles de Beneficiarios<a class="headerlink" href="#consulta-de-ventas-de-servicios-y-detalles-de-beneficiarios" title="Permanent link">&para;</a></h3>
<p>Esta consulta SQL extrae informaci贸n de ventas de servicios de la tabla <code>servi21</code> en combinaci贸n con datos adicionales de las tablas <code>servi20</code> y <code>servi03</code>. La uni贸n se realiza entre <code>servi21</code> y <code>servi20</code> usando los campos <code>marca</code> y <code>documento</code>, y se limitan los resultados a las ventas en un per铆odo de 18 meses desde la fecha actual.</p>
<p>El resultado incluye detalles de cada venta, como <code>DOCUMENTO_VENTA</code>, <code>MARCA_VENTA</code>, <code>PERIODO</code>, <code>FECHA_VENTA</code>, <code>TIPO_BENEFICIARIO</code>, <code>CATEGORIA_VENTA</code>, y otros campos descriptivos de los servicios y su costo (<code>VALOR_SERVICIO</code>, <code>VALOR_DESCONTADO</code>, <code>VALOR_COSTO</code>, <code>VALOR_SUBSIDIO</code>). La tabla <code>servi03</code> se usa para obtener descripciones de categor铆as, mientras que <code>servi20</code> aporta detalles de estado y fechas.</p>
<p>Este c贸digo asegura la configuraci贸n para ejecutar la consulta y cargar los datos en <code>df_structure</code> para su posterior procesamiento y an谩lisis.</p>
<div class="highlight"><pre><span></span><code><span class="c1">#Lista de querys</span>
<span class="n">qr_structure</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;BD_Fact_Ventas_Servicios&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;&#39;SELECT </span>
<span class="s1">        s21.documento DOCUMENTO_VENTA,</span>
<span class="s1">        s21.marca AS MARCA_VENTA,</span>
<span class="s1">        DATE_FORMAT(s20.fecha, &#39;%Y%m&#39;) AS PERIODO,</span>
<span class="s1">        s20.fecha FECHA_VENTA,</span>
<span class="s1">        s21.sec as CONSECUTIVO_VENTA,</span>
<span class="s1">        s20.estado as ESTADO_VENTA,</span>
<span class="s1">        s20.fecest as FECHA_ESTADO,</span>
<span class="s1">        s21.tipben AS TIPO_BENEFICIARIO,</span>
<span class="s1">        s21.codcat,</span>
<span class="s1">    s3.detalle as CATEGORIA_VENTA,</span>
<span class="s1">    s21.codben AS CODBEN,</span>
<span class="s1">    s21.nombre,</span>
<span class="s1">    s21.edad,</span>
<span class="s1">    s21.sexo,</span>
<span class="s1">    s21.codser AS COD_SERVICIO,</span>
<span class="s1">    s21.numero AS NUMERO_APERTURA,</span>
<span class="s1">    s21.codinf AS COD_INFRAESTRUCTURA,</span>
<span class="s1">    s21.perate AS PERSONAS_ATENDIDAS,</span>
<span class="s1">    s21.numpar AS NUMERO_PARTICIPANTES,</span>
<span class="s1">    s21.usos AS NUMERO_USOS,</span>
<span class="s1">    s21.cantidad AS CANTIDAD_UNIDADES,</span>
<span class="s1">    s21.valser AS VALOR_SERVICIO,</span>
<span class="s1">    s21.valdes AS VALOR_DESCONTADO,</span>
<span class="s1">    s21.valcos AS VALOR_COSTO,</span>
<span class="s1">    s21.valsub AS VALOR_SUBSIDIO, </span>
<span class="s1">    s21.ruaf,</span>
<span class="s1">    s21.numrua,</span>
<span class="s1">    s21.estafi AS ESTADO_AFILIACION</span>
<span class="s1">    FROM servicios.servi21 s21</span>

<span class="s1">    right join (select </span>
<span class="s1">                marca,documento,fecha, estado, fecest</span>
<span class="s1">                from servicios.servi20</span>
<span class="s1">    WHERE DATE_FORMAT(servi20.fecha, &#39;%Y%m%01&#39;)&gt;= DATE_SUB(CURDATE(), INTERVAL 18 MONTH) and servi20.fecha &lt;=CURDATE()</span>
<span class="s1">     and servi20.documento is not null</span>
<span class="s1">    ) as s20 on s21.marca = s20.marca and s21.documento = s20.documento</span>
<span class="s1">    left join servicios.servi03 s3 on s21.codcat = s3.codcat</span>
<span class="s1">    &#39;&#39;&#39;</span>
<span class="p">}</span>
<span class="n">dim_names</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;BD_Fact_Ventas_Servicios&quot;</span><span class="p">:</span><span class="s1">&#39;BD_Fact_Ventas_Servicios&#39;</span>
               <span class="p">}</span>
<span class="n">df_structure</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;LECTURA DE QUERYS&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-23 17:47:33,985 - INFO - LECTURA DE QUERYS
</code></pre></div>

<h3 id="carga-de-tablas-desde-sql">Carga de tablas desde SQL<a class="headerlink" href="#carga-de-tablas-desde-sql" title="Permanent link">&para;</a></h3>
<p>Se ejecutan las consultas SQL definidas en <code>qr_structure</code> y se cargan los resultados en el diccionario <code>df_structure</code>. Para cada consulta, se utiliza un bloque <code>with</code> para manejar la conexi贸n de manera segura. El nombre de cada tabla cargada se registra en el log junto con el tiempo total del proceso de carga desde MySQL.</p>
<div class="highlight"><pre><span></span><code><span class="c1">#Conexion a base Minerva</span>
<span class="n">motor</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">obtener_conexion</span><span class="p">(</span><span class="s1">&#39;minerva&#39;</span><span class="p">))</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;CONEXION A BASE MINERVA&#39;</span><span class="p">)</span>
<span class="n">cargar_tablas</span><span class="p">(</span><span class="n">motor</span><span class="p">,</span> <span class="n">qr_structure</span><span class="p">,</span> <span class="n">df_structure</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-23 17:47:34,036 - INFO - CONEXION A BASE MINERVA
2024-10-23 17:47:34,339 - INFO - Cargando BD_Fact_Ventas_Servicios 
2024-10-23 17:48:22,047 - INFO - Cargada BD_Fact_Ventas_Servicios --- 47.71 seconds ---
2024-10-23 17:48:22,261 - INFO - CARGUE TABLAS DESDE MYSQL --- BD_Fact_Ventas_Servicios --- 48.22 seconds ---
</code></pre></div>

<h3 id="validacion-y-limpieza-de-datos-en-tablas-de-ventas-y-dimension-de-datos-fijos">Validaci贸n y Limpieza de Datos en Tablas de Ventas y Dimensi贸n de Datos Fijos<a class="headerlink" href="#validacion-y-limpieza-de-datos-en-tablas-de-ventas-y-dimension-de-datos-fijos" title="Permanent link">&para;</a></h3>
<p>Este bloque de c贸digo realiza validaciones, transformaciones y limpieza de datos en el diccionario <code>df_structure</code>, que contiene los resultados de consultas sobre ventas de servicios. En la primera etapa, se verifica si existen duplicados en las tablas usando <code>StoreDuplicated</code>, que genera un archivo de trazabilidad de duplicados si se encuentran registros repetidos. Luego, se eliminan duplicados directamente de las tablas para asegurar la integridad de los datos.</p>
<p>En la segunda etapa, se normalizan y limpian los datos en cada tabla de <code>df_structure</code> transformando los nombres de columnas y los valores de las columnas de tipo texto a may煤sculas. Adem谩s, se eliminan los espacios en los extremos y se reemplazan las cadenas <code>"NAN"</code> o <code>"NONE"</code> por valores <code>NaN</code> de NumPy, asegurando consistencia en los valores faltantes.</p>
<p>La 煤ltima parte define una consulta <code>qr_structure_datos_fijos</code> para la tabla <code>BD_Dim_Datos_Fijos</code>, que se usa para obtener datos fijos, como c贸digos y documentos, que complementan el an谩lisis de ventas. El resultado de esta consulta se cargar谩 en <code>df_structure_datos_fijos</code> para su procesamiento posterior.</p>
<div class="highlight"><pre><span></span><code><span class="c1">#Validador de campos repetidos </span>
<span class="n">validador_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">ky</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_structure</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>   
    <span class="n">ColumnsToCompare</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_structure</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span> <span class="s1">&#39;id&#39;</span> <span class="p">]</span> <span class="p">]</span>
    <span class="n">StoreDuplicated</span><span class="p">(</span><span class="s1">&#39;N/A&#39;</span> <span class="p">,</span> <span class="n">ColumnsToCompare</span><span class="p">,</span> <span class="n">df_structure</span><span class="p">[</span><span class="n">ky</span><span class="p">],</span> <span class="sa">r</span><span class="s1">&#39;trazaDuplicados_&#39;</span> <span class="o">+</span> <span class="n">ky</span> <span class="p">)</span>
    <span class="c1">#Limpieza inicial quitar duplicados</span>
    <span class="n">df_structure</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_structure</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;VALIDADOR TABLA: &#39;</span><span class="o">+</span> <span class="n">ky</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;VALIDADOR DUPLICADOS --- </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">validador_time</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> seconds ---&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-23 17:48:29,273 - INFO - VALIDADOR TABLA: BD_Fact_Ventas_Servicios
2024-10-23 17:48:29,274 - INFO - VALIDADOR DUPLICADOS --- 7.00 seconds ---
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1">#Transformaci贸n 2</span>
<span class="n">limpieza_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">ky</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_structure</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="c1">#print(ky)</span>
    <span class="c1"># Convertir todos los nombres de las columnas a may煤sculas</span>
    <span class="n">df_structure</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df_structure</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="c1">#Pasar las columnas tipo texto a UPPER</span>
    <span class="n">df_structure</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_structure</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="c1">#En las columnas tipo texto, eliminar espacios al comienzo y al final</span>
    <span class="n">df_structure</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_structure</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="c1">#Reemplazar los &quot;NAN&quot; o &quot;NONE&quot; por NaN</span>
    <span class="n">df_structure</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_structure</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;NAN&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">df_structure</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_structure</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;NONE&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;LIMPIEZA --- </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">limpieza_time</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> seconds ---&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-23 17:48:52,981 - INFO - LIMPIEZA --- 23.70 seconds ---
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1">#Lista de querys</span>
<span class="n">qr_structure_datos_fijos</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;BD_Dim_Datos_Fijos&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;&#39;SELECT CODDOC, DOCUMENTO FROM dwh.BD_Dim_Datos_Fijos </span>
<span class="s1">    &#39;&#39;&#39;</span>
<span class="p">}</span>
<span class="n">dim_names_datos_fijos</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;BD_Fact_Ventas_Servicios&quot;</span><span class="p">:</span><span class="s1">&#39;BD_Fact_Ventas_Servicios&#39;</span>
               <span class="p">}</span>
<span class="n">df_structure_datos_fijos</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;LECTURA DE QUERYS&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-23 17:48:52,986 - INFO - LECTURA DE QUERYS
</code></pre></div>

<h3 id="conexion-a-la-base-de-datos-dwh-y-carga-de-tabla-de-datos-fijos">Conexi贸n a la Base de Datos DWH y Carga de Tabla de Datos Fijos<a class="headerlink" href="#conexion-a-la-base-de-datos-dwh-y-carga-de-tabla-de-datos-fijos" title="Permanent link">&para;</a></h3>
<p>Este c贸digo establece una conexi贸n con la base de datos DWH utilizando la funci贸n <code>obtener_conexion</code>, que proporciona los detalles de conexi贸n para el motor <code>motor_dwh</code>. La conexi贸n es utilizada para ejecutar consultas en la base de datos, en este caso, cargando las consultas definidas en <code>qr_structure_datos_fijos</code> y almacenando los resultados en <code>df_structure_datos_fijos</code>.</p>
<p>La funci贸n <code>cargar_tablas</code> toma como par谩metros el motor de conexi贸n, el diccionario de consultas, el diccionario donde se almacenar谩n los datos (<code>df_structure_datos_fijos</code>), y el logger para registrar eventos. Esta configuraci贸n permite realizar la carga de datos de la tabla <code>BD_Dim_Datos_Fijos</code>, que incluye informaci贸n como c贸digos y documentos, asegurando su disponibilidad para futuros an谩lisis y validaciones.</p>
<div class="highlight"><pre><span></span><code><span class="c1">#Conexion a base Minerva</span>
<span class="n">motor_dwh</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">obtener_conexion</span><span class="p">(</span><span class="s1">&#39;dwh&#39;</span><span class="p">))</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;CONEXION A BASE DWH&#39;</span><span class="p">)</span>
<span class="n">cargar_tablas</span><span class="p">(</span><span class="n">motor_dwh</span><span class="p">,</span> <span class="n">qr_structure_datos_fijos</span><span class="p">,</span> <span class="n">df_structure_datos_fijos</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-23 17:48:53,001 - INFO - CONEXION A BASE DWH
2024-10-23 17:48:53,297 - INFO - Cargando BD_Dim_Datos_Fijos 
2024-10-23 17:48:58,690 - INFO - Cargada BD_Dim_Datos_Fijos --- 5.39 seconds ---
2024-10-23 17:48:58,768 - INFO - CARGUE TABLAS DESDE MYSQL --- BD_Dim_Datos_Fijos --- 5.77 seconds ---
</code></pre></div>

<h3 id="eliminacion-de-duplicados-y-normalizacion-de-datos-en-ventas-de-servicios">Eliminaci贸n de Duplicados y Normalizaci贸n de Datos en Ventas de Servicios<a class="headerlink" href="#eliminacion-de-duplicados-y-normalizacion-de-datos-en-ventas-de-servicios" title="Permanent link">&para;</a></h3>
<p>Este bloque de c贸digo realiza uniones y transformaciones en los datos de ventas de servicios y documentos en <code>df_structure</code>. Primero, elimina duplicados en <code>df_structure_datos_fijos['BD_Dim_Datos_Fijos']</code> para conservar 煤nicamente el 煤ltimo registro de cada documento, garantizando que solo se mantenga la informaci贸n m谩s reciente de cada documento.</p>
<p>A continuaci贸n, <code>df_ventas</code> y <code>df_datos_fijos</code> se combinan mediante un <code>join</code> en <code>CODBEN</code> y <code>DOCUMENTO</code>, proporcionando el tipo de documento al conjunto de datos de ventas. Luego, se crea un identificador 煤nico <code>ID_AFILIADO</code> concatenando <code>CODDOC</code> y <code>CODBEN</code>, y se reorganizan las columnas para que <code>ID_AFILIADO</code> se ubique en la quinta posici贸n, mejorando la legibilidad de los datos.</p>
<p>Para asegurar consistencia en los tipos de datos, se rellenan valores faltantes en <code>CONSECUTIVO_VENTA</code>, <code>EDAD</code>, y <code>NUMERO_APERTURA</code> con ceros. Posteriormente, estos campos se convierten a tipo <code>int</code> para mantener la integridad de los datos. Finalmente, <code>df_structure['BD_Fact_Ventas_Servicios']</code> se actualiza con el DataFrame <code>df_joined</code>, listo para el an谩lisis o carga en la base de datos.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Eliminar duplicados y quedarse con el 煤ltimo registro</span>
<span class="n">df_structure_datos_fijos</span><span class="p">[</span><span class="s1">&#39;BD_Dim_Datos_Fijos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_structure_datos_fijos</span><span class="p">[</span><span class="s1">&#39;BD_Dim_Datos_Fijos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">)</span>

<span class="c1"># Supongamos que los DataFrames son df_ventas y df_datos_fijos</span>
<span class="n">df_ventas</span> <span class="o">=</span> <span class="n">df_structure</span><span class="p">[</span><span class="s1">&#39;BD_Fact_Ventas_Servicios&#39;</span><span class="p">]</span>
<span class="n">df_datos_fijos</span> <span class="o">=</span> <span class="n">df_structure_datos_fijos</span><span class="p">[</span><span class="s1">&#39;BD_Dim_Datos_Fijos&#39;</span><span class="p">]</span>

<span class="c1"># Realizar el join para traer el tipo de documento</span>
<span class="n">df_joined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_ventas</span><span class="p">,</span> <span class="n">df_datos_fijos</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;CODBEN&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>

<span class="c1"># Crear la columna &#39;ID_AFILIADO&#39; concatenando &#39;CODDOC&#39; y &#39;CODBEN&#39;</span>
<span class="n">df_joined</span><span class="p">[</span><span class="s1">&#39;ID_AFILIADO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_joined</span><span class="p">[</span><span class="s1">&#39;CODDOC&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_joined</span><span class="p">[</span><span class="s1">&#39;CODBEN&#39;</span><span class="p">]</span>

<span class="c1"># Reorganizar las columnas para que &#39;ID_AFILIADO&#39; est茅 en la quinta posici贸n</span>
<span class="n">columnas_ordenadas</span> <span class="o">=</span> <span class="n">df_joined</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">columnas_ordenadas</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">columnas_ordenadas</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">columnas_ordenadas</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;ID_AFILIADO&#39;</span><span class="p">)))</span>
<span class="n">df_joined</span> <span class="o">=</span> <span class="n">df_joined</span><span class="p">[</span><span class="n">columnas_ordenadas</span><span class="p">]</span>

<span class="c1"># Ajustar tipos de dato enteros </span>
<span class="c1"># Reemplazar valores NaN por 0</span>
<span class="n">df_joined</span><span class="p">[</span><span class="s1">&#39;CONSECUTIVO_VENTA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_joined</span><span class="p">[</span><span class="s1">&#39;CONSECUTIVO_VENTA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df_joined</span><span class="p">[</span><span class="s1">&#39;EDAD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_joined</span><span class="p">[</span><span class="s1">&#39;EDAD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df_joined</span><span class="p">[</span><span class="s1">&#39;NUMERO_APERTURA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_joined</span><span class="p">[</span><span class="s1">&#39;NUMERO_APERTURA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Convertir a float y luego a entero</span>
<span class="n">df_joined</span><span class="p">[</span><span class="s1">&#39;CONSECUTIVO_VENTA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_joined</span><span class="p">[</span><span class="s1">&#39;CONSECUTIVO_VENTA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">df_joined</span><span class="p">[</span><span class="s1">&#39;EDAD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_joined</span><span class="p">[</span><span class="s1">&#39;EDAD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">df_joined</span><span class="p">[</span><span class="s1">&#39;NUMERO_APERTURA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_joined</span><span class="p">[</span><span class="s1">&#39;NUMERO_APERTURA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">df_structure</span><span class="p">[</span><span class="s1">&#39;BD_Fact_Ventas_Servicios&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_joined</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_structure</span><span class="p">[</span><span class="s1">&#39;BD_Fact_Ventas_Servicios&#39;</span><span class="p">]</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DOCUMENTO_VENTA</th>
      <th>MARCA_VENTA</th>
      <th>PERIODO</th>
      <th>FECHA_VENTA</th>
      <th>CONSECUTIVO_VENTA</th>
      <th>ID_AFILIADO</th>
      <th>ESTADO_VENTA</th>
      <th>FECHA_ESTADO</th>
      <th>TIPO_BENEFICIARIO</th>
      <th>CODCAT</th>
      <th>...</th>
      <th>CANTIDAD_UNIDADES</th>
      <th>VALOR_SERVICIO</th>
      <th>VALOR_DESCONTADO</th>
      <th>VALOR_COSTO</th>
      <th>VALOR_SUBSIDIO</th>
      <th>RUAF</th>
      <th>NUMRUA</th>
      <th>ESTADO_AFILIACION</th>
      <th>CODDOC</th>
      <th>DOCUMENTO</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0048360</td>
      <td>01</td>
      <td>202305</td>
      <td>2023-05-02</td>
      <td>1</td>
      <td>CC1082875116</td>
      <td>A</td>
      <td>2023-05-02</td>
      <td>B</td>
      <td>3</td>
      <td>...</td>
      <td>1.0</td>
      <td>4600.0</td>
      <td>0.0</td>
      <td>4600.0</td>
      <td>0.0</td>
      <td>N</td>
      <td>0.0</td>
      <td>A</td>
      <td>CC</td>
      <td>1082875116</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0048362</td>
      <td>01</td>
      <td>202305</td>
      <td>2023-05-02</td>
      <td>1</td>
      <td>CC1082995375</td>
      <td>A</td>
      <td>2023-05-02</td>
      <td>C</td>
      <td>2</td>
      <td>...</td>
      <td>1.0</td>
      <td>300800.0</td>
      <td>0.0</td>
      <td>470029.0</td>
      <td>169229.0</td>
      <td>N</td>
      <td>0.0</td>
      <td>A</td>
      <td>CC</td>
      <td>1082995375</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0048362</td>
      <td>01</td>
      <td>202305</td>
      <td>2023-05-02</td>
      <td>2</td>
      <td>CC1082995375</td>
      <td>A</td>
      <td>2023-05-02</td>
      <td>C</td>
      <td>2</td>
      <td>...</td>
      <td>1.0</td>
      <td>300800.0</td>
      <td>0.0</td>
      <td>470029.0</td>
      <td>169229.0</td>
      <td>N</td>
      <td>0.0</td>
      <td>A</td>
      <td>CC</td>
      <td>1082995375</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0048362</td>
      <td>01</td>
      <td>202305</td>
      <td>2023-05-02</td>
      <td>3</td>
      <td>CC1082995375</td>
      <td>A</td>
      <td>2023-05-02</td>
      <td>C</td>
      <td>2</td>
      <td>...</td>
      <td>1.0</td>
      <td>300800.0</td>
      <td>0.0</td>
      <td>470029.0</td>
      <td>169229.0</td>
      <td>N</td>
      <td>0.0</td>
      <td>A</td>
      <td>CC</td>
      <td>1082995375</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0048362</td>
      <td>01</td>
      <td>202305</td>
      <td>2023-05-02</td>
      <td>4</td>
      <td>CC1082995375</td>
      <td>A</td>
      <td>2023-05-02</td>
      <td>C</td>
      <td>2</td>
      <td>...</td>
      <td>1.0</td>
      <td>300800.0</td>
      <td>0.0</td>
      <td>470029.0</td>
      <td>169229.0</td>
      <td>N</td>
      <td>0.0</td>
      <td>A</td>
      <td>CC</td>
      <td>1082995375</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>968253</th>
      <td>0045153</td>
      <td>999</td>
      <td>202410</td>
      <td>2024-10-18</td>
      <td>1</td>
      <td>CC12555412</td>
      <td>A</td>
      <td>NaN</td>
      <td>B</td>
      <td>1</td>
      <td>...</td>
      <td>1.0</td>
      <td>5000.0</td>
      <td>0.0</td>
      <td>50314.0</td>
      <td>45314.0</td>
      <td>N</td>
      <td>0.0</td>
      <td>A</td>
      <td>CC</td>
      <td>12555412</td>
    </tr>
    <tr>
      <th>968254</th>
      <td>0045156</td>
      <td>999</td>
      <td>202410</td>
      <td>2024-10-18</td>
      <td>1</td>
      <td>CC1082974320</td>
      <td>A</td>
      <td>NaN</td>
      <td>T</td>
      <td>1</td>
      <td>...</td>
      <td>1.0</td>
      <td>5000.0</td>
      <td>0.0</td>
      <td>50314.0</td>
      <td>45314.0</td>
      <td>N</td>
      <td>0.0</td>
      <td>A</td>
      <td>CC</td>
      <td>1082974320</td>
    </tr>
    <tr>
      <th>968255</th>
      <td>0045158</td>
      <td>999</td>
      <td>202410</td>
      <td>2024-10-18</td>
      <td>2</td>
      <td>CC1103120382</td>
      <td>A</td>
      <td>NaN</td>
      <td>C</td>
      <td>2</td>
      <td>...</td>
      <td>1.0</td>
      <td>18400.0</td>
      <td>0.0</td>
      <td>38743.0</td>
      <td>20343.0</td>
      <td>N</td>
      <td>0.0</td>
      <td>A</td>
      <td>CC</td>
      <td>1103120382</td>
    </tr>
    <tr>
      <th>968256</th>
      <td>0045159</td>
      <td>999</td>
      <td>202410</td>
      <td>2024-10-18</td>
      <td>1</td>
      <td>CC36694980</td>
      <td>A</td>
      <td>NaN</td>
      <td>T</td>
      <td>1</td>
      <td>...</td>
      <td>1.0</td>
      <td>5000.0</td>
      <td>0.0</td>
      <td>50314.0</td>
      <td>45314.0</td>
      <td>N</td>
      <td>0.0</td>
      <td>A</td>
      <td>CC</td>
      <td>36694980</td>
    </tr>
    <tr>
      <th>968257</th>
      <td>0045159</td>
      <td>999</td>
      <td>202410</td>
      <td>2024-10-18</td>
      <td>2</td>
      <td>CC7634231</td>
      <td>A</td>
      <td>NaN</td>
      <td>C</td>
      <td>1</td>
      <td>...</td>
      <td>1.0</td>
      <td>5000.0</td>
      <td>0.0</td>
      <td>50314.0</td>
      <td>45314.0</td>
      <td>N</td>
      <td>0.0</td>
      <td>A</td>
      <td>CC</td>
      <td>7634231</td>
    </tr>
  </tbody>
</table>
<p>968258 rows  31 columns</p>
</div>

<h3 id="guardar-en-base-de-datos-dwh">Guardar en base de datos DWH<a class="headerlink" href="#guardar-en-base-de-datos-dwh" title="Permanent link">&para;</a></h3>
<p>Se guarda cada tabla de <code>df_structure</code> en la base de datos DWH, verificando primero que la clave est茅 en el diccionario <code>dim_names</code> para asignar el nombre de la tabla correspondiente. Si la clave no est谩 presente, se genera una advertencia en el log. El tiempo total del proceso de almacenamiento se registra en el log, junto con los nombres de las tablas almacenadas correctamente.</p>
<div class="highlight"><pre><span></span><code><span class="n">guardar_en_dwh</span><span class="p">(</span><span class="n">df_structure</span><span class="p">,</span> <span class="n">dim_names</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-23 17:49:04,656 - INFO - Intentando conexi贸n a la base DWH...
2024-10-23 17:49:04,658 - INFO - Conexi贸n a la base DWH establecida con 茅xito.
2024-10-23 17:49:04,956 - INFO - Almacenando tabla BD_Fact_Ventas_Servicios en DWH como BD_Fact_Ventas_Servicios
2024-10-23 17:51:45,220 - INFO - Tabla BD_Fact_Ventas_Servicios almacenada correctamente como BD_Fact_Ventas_Servicios.
2024-10-23 17:51:46,478 - INFO - ALMACENAMIENTO ---  --- 2.70 minutes ---
2024-10-23 17:51:46,479 - INFO - Finalizando proceso de almacenamiento en DWH.
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;FINAL ETL --- </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> seconds ---&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-23 17:51:46,491 - INFO - FINAL ETL --- 252.53 seconds ---
</code></pre></div>

<div class="highlight"><pre><span></span><code>
</code></pre></div>
<div class="highlight"><pre><span></span><code>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../js/init_mermaid.js"></script>
      
    
  </body>
</html>