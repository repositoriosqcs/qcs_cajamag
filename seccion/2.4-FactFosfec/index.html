
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../2.3-FactSubsidioVivienda/">
      
      
        <link rel="next" href="../2.2-FactEstadoGiroCuota/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>2.4 FactFosfec - Optimización CAJAMAG - Gobierno de Datos</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="#d89717" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#24-fact-fos-fec" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="Optimización CAJAMAG - Gobierno de Datos" class="md-header__button md-logo" aria-label="Optimización CAJAMAG - Gobierno de Datos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Optimización CAJAMAG - Gobierno de Datos
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2.4 FactFosfec
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Optimización CAJAMAG - Gobierno de Datos" class="md-nav__button md-logo" aria-label="Optimización CAJAMAG - Gobierno de Datos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Optimización CAJAMAG - Gobierno de Datos
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    INTRODUCCIÓN
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../instalacion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    INSTALACIÓN Y CONFIGURACIÓN
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../buenaspracticas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BUENAS PRACTICAS
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../codigo/funciones/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FUNCIONES
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    BODEGAS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            BODEGAS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    1. Bodega 1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            1. Bodega 1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Bloque1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intoduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.1-DimDatosFijos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.1 DimDatosFijos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.2-DimCalendarioMensual/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.2 DimCalendarioMensual
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.3-Dimensiones/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.3 Dimensiones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.4-Dimensiones_xml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.4 Dimensiones xml
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.5-FactDatosContacto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.5 FactDatosContacto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.6-Fact_Historico_Afiliacion_Empresas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.6 Fact Historico Afiliacion Empresas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.7-Fact_Historico_Trabajadores1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.7 Fact Historico Trabajadores1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.7-Fact_Historico_Trabajadores2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.7 Fact Historico Trabajadores2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.8-Fact_HistoricoBeneficiarios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.8 Fact HistoricoBeneficiarios
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.9-Dim_Parametricas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.9 Dim Parametricas
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" checked>
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2. Bodega 2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            2. Bodega 2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Bloque2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intoduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.1-FactAportesEmpAfiliadas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.1 FactAportesEmpAfiliadas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.1-FactHistoricoAportesTotales/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.1 FactHistoricoAportesTotales
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.2-FactHistoricoCuota/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.2 FactHistoricoCuota
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.3-FactSubsidioVivienda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.3 FactSubsidioVivienda
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    2.4 FactFosfec
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    2.4 FactFosfec
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduccion" class="md-nav__link">
    <span class="md-ellipsis">
      Introducción
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introducción">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diagrama-de-secuencia-para-el-proceso-etl" class="md-nav__link">
    <span class="md-ellipsis">
      Diagrama de Secuencia para el Proceso ETL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importacion-de-bibliotecas-y-configuracion-inicial" class="md-nav__link">
    <span class="md-ellipsis">
      Importación de bibliotecas y configuración inicial
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definicion-de-consultas-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Definición de consultas SQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conexion-y-carga-de-tablas-desde-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Conexión y carga de tablas desde SQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definicion-de-funciones-de-transformacion-y-limpieza" class="md-nav__link">
    <span class="md-ellipsis">
      Definición de funciones de transformación y limpieza
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proceso-de-limpieza-y-validacion-de-duplicados" class="md-nav__link">
    <span class="md-ellipsis">
      Proceso de limpieza y validación de duplicados
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guardar-en-la-base-de-datos-dwh" class="md-nav__link">
    <span class="md-ellipsis">
      Guardar en la base de datos DWH
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.2-FactEstadoGiroCuota/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.2 FactEstadoGiroCuota
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.5-Fact_HistoricoMoraEmp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.5 Fact HistoricoMoraEmp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.6-FactHistoricoANS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.6 FactHistoricoANS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.7-FactHistoricoSubPrescrito/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.7 FactHistoricoSubPrescrito
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.8-FactHistoricoRecobro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.8 FactHistoricoRecobro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.9-FactHistoricoRecuperado/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.9 FactHistoricoRecuperado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.10-FactIgestion_Mercurio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.10 FactIgestion Mercurio
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    3. Bodega 3
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            3. Bodega 3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Bloque3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intoduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3.1-FactTransaccionesVentas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.1 FactTransaccionesVentas
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    4. Bodega 4
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            4. Bodega 4
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Bloque4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intoduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4.1-FactColegio_fijos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.1 FactColegio fijos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4.2-FactColegio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.2 FactColegio
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    5. Bodega 5
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            5. Bodega 5
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Bloque5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intoduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5.1-FactServicioSocial_Fijos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.1 FactServicioSocial Fijos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5.2-FactServicioSocial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.2 FactServicioSocial
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    6. Bodega 6
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            6. Bodega 6
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Bloque6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intoduccion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6.1-FactEncuestas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.1 FactEncuestas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6.2-Fact_Encuesta_afil_empleador/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.2 Fact Encuesta afil empleador
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduccion" class="md-nav__link">
    <span class="md-ellipsis">
      Introducción
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introducción">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diagrama-de-secuencia-para-el-proceso-etl" class="md-nav__link">
    <span class="md-ellipsis">
      Diagrama de Secuencia para el Proceso ETL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importacion-de-bibliotecas-y-configuracion-inicial" class="md-nav__link">
    <span class="md-ellipsis">
      Importación de bibliotecas y configuración inicial
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definicion-de-consultas-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Definición de consultas SQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conexion-y-carga-de-tablas-desde-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Conexión y carga de tablas desde SQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definicion-de-funciones-de-transformacion-y-limpieza" class="md-nav__link">
    <span class="md-ellipsis">
      Definición de funciones de transformación y limpieza
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proceso-de-limpieza-y-validacion-de-duplicados" class="md-nav__link">
    <span class="md-ellipsis">
      Proceso de limpieza y validación de duplicados
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guardar-en-la-base-de-datos-dwh" class="md-nav__link">
    <span class="md-ellipsis">
      Guardar en la base de datos DWH
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="24-fact-fos-fec">2.4 Fact Fos fec<a class="headerlink" href="#24-fact-fos-fec" title="Permanent link">&para;</a></h1>
<h2 id="introduccion">Introducción<a class="headerlink" href="#introduccion" title="Permanent link">&para;</a></h2>
<p>Este proceso ETL para la tabla <code>FactFosfec</code> permite la extracción, transformación y carga de datos de la base de datos Minerva a un Data Warehouse (DWH) en la tabla <code>BD_Fact_Fosfec</code>. Inicia con la importación de bibliotecas y funciones personalizadas para el manejo de datos, configurando el <code>logger</code> para registrar eventos en un archivo log (<code>FactFosFec.log</code>). Luego, se realiza la extracción de datos desde múltiples tablas en la base de datos <code>fosfec</code> con una consulta SQL en <code>qr_structure</code>, que obtiene información clave relacionada con fechas, documentos y salarios de los afiliados. Posteriormente, se validan y eliminan duplicados, limpiando errores antes de realizar la carga final en el DWH. Al finalizar, el tiempo de ejecución de cada etapa y del proceso completo se registra en el log para facilitar el monitoreo y optimización futura.</p>
<h3 id="diagrama-de-secuencia-para-el-proceso-etl">Diagrama de Secuencia para el Proceso ETL<a class="headerlink" href="#diagrama-de-secuencia-para-el-proceso-etl" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    title Diagrama de Secuencia para el Proceso ETL - FactFosfec
    participant 👤 Usuario
    participant ETL_Script
    participant Minerva_DB as Base de Datos Minerva
    participant DWH as Data Warehouse

    👤 Usuario -&gt;&gt; ETL_Script: Ejecuta el script ETL
    ETL_Script -&gt;&gt; ETL_Script: Configura entorno y logger
    ETL_Script -&gt;&gt; Minerva_DB: Conecta a BD Minerva
    Minerva_DB --&gt;&gt; ETL_Script: Conexión exitosa
    ETL_Script -&gt;&gt; Minerva_DB: Ejecuta consulta SQL para extraer datos de `fosfec`
    Minerva_DB --&gt;&gt; ETL_Script: Retorna datos de `fact_foscec`
    ETL_Script -&gt;&gt; ETL_Script: Valida y elimina duplicados en los datos
    ETL_Script -&gt;&gt; ETL_Script: Limpia errores en los datos
    ETL_Script -&gt;&gt; DWH: Conecta a BD DWH
    DWH --&gt;&gt; ETL_Script: Conexión exitosa
    ETL_Script -&gt;&gt; DWH: Carga datos en la tabla `BD_Fact_Fosfec`
    DWH --&gt;&gt; ETL_Script: Confirmación de carga exitosa
    ETL_Script -&gt;&gt; 👤 Usuario: Finaliza proceso ETL y registra tiempo</code></pre>
<h3 id="importacion-de-bibliotecas-y-configuracion-inicial">Importación de bibliotecas y configuración inicial<a class="headerlink" href="#importacion-de-bibliotecas-y-configuracion-inicial" title="Permanent link">&para;</a></h3>
<p>Este bloque configura el entorno de trabajo para ejecutar un proceso ETL, importando varias bibliotecas necesarias como <code>SQLAlchemy</code> para la conexión a bases de datos, <code>Pandas</code> para la manipulación de datos, y <code>logging</code> para el registro de eventos en un archivo de log (<code>FactFosFec.log</code>). A continuación, el código importa un conjunto de funciones personalizadas desde el módulo <code>Funciones.py</code>, ubicado en un directorio superior, agregando su ruta al <code>sys.path</code>. Entre las funciones clave importadas están <code>guardar_en_dwh</code>, <code>StoreDuplicated</code>, <code>RemoveDuplicated</code>, <code>RemoveErrors</code>, y <code>cargar_tablas</code>, que permiten manipular los datos, eliminar duplicados y errores, y almacenar los resultados en un Data Warehouse.</p>
<p>Al configurar el <code>logger</code> con <code>setup_logger</code>, se asegura que el proceso registre eventos importantes, comenzando con un mensaje inicial ("COMIENZO ETL") para trazar el flujo del proceso y facilitar el monitoreo del desempeño y la identificación de errores durante la ejecución del ETL.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Importar bibliotecas necesarias</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>


<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="c1">#---------------------------------------------</span>

<span class="c1">#Import de modulo funciones</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Agrega el directorio al sys.path</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;../funciones&#39;</span><span class="p">))</span>
<span class="c1"># Importa las funciones desde el archivo Funciones.py</span>
<span class="kn">from</span> <span class="nn">Funciones</span> <span class="kn">import</span> <span class="n">guardar_en_dwh</span><span class="p">,</span> <span class="n">StoreDuplicated</span><span class="p">,</span> <span class="n">RemoveDuplicated</span><span class="p">,</span> <span class="n">RemoveErrors</span><span class="p">,</span> <span class="n">cargar_tablas</span><span class="p">,</span> <span class="n">obtener_conexion</span><span class="p">,</span> <span class="n">testfunciones</span><span class="p">,</span> <span class="n">setup_logger</span>
<span class="nb">print</span><span class="p">(</span><span class="n">testfunciones</span><span class="p">())</span>

<span class="c1"># Configuración inicial</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">setup_logger</span><span class="p">(</span><span class="n">log_filename</span><span class="o">=</span><span class="s1">&#39;FactFosFec.log&#39;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;COMIENZO ETL&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-23 14:50:24,325 - INFO - COMIENZO ETL


Importacion de funciones correcta, 23-10-2024 14:50
</code></pre></div>

<h3 id="definicion-de-consultas-sql">Definición de consultas SQL<a class="headerlink" href="#definicion-de-consultas-sql" title="Permanent link">&para;</a></h3>
<p>Se define una consulta SQL en el diccionario <code>qr_structure</code> que extrae datos de las tablas <code>fosfec160</code>, <code>fosfec07</code>, <code>fosfec09</code>, y <code>fosfec21</code> de la base de datos <code>fosfec</code>, utilizando varias combinaciones de <code>INNER JOIN</code> y <code>LEFT JOIN</code>. La consulta selecciona columnas clave relacionadas con fechas, documentos y salarios. El proceso de lectura de consultas se registra en el log.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Consultas SQL</span>

<span class="n">qr_structure</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;fact_foscec&quot;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    SELECT</span>
<span class="s1">        fosfec160.id as REGISTRO_WEB,</span>
<span class="s1">        CONCAT(fosfec160.tipdoc,fosfec160.cedtra) AS ID_AFILIADO,</span>
<span class="s1">        DATE_FORMAT(fecsis, &#39;%Y%m&#39;) AS PERIODO,</span>
<span class="s1">        fosfec160.tipdoc AS TIPO_DOCUMENTO,</span>
<span class="s1">        fosfec160.cedtra AS NUMERO_DOCUMENTO,</span>
<span class="s1">        fosfec160.fecexp AS FECHA_EXPEDICION_DOC,</span>
<span class="s1">        fosfec160.fecsis AS FECHA_SISTEMA,</span>
<span class="s1">        fosfec07.fecasi AS FECHA_ASIGNACION,</span>
<span class="s1">        fosfec07.fecest AS FECHA_ESTADO,</span>
<span class="s1">        fosfec09.fecnac AS FECHA_NACIMIENTO,</span>
<span class="s1">        fosfec160.fecfin AS FECHA_FINAL_BENEFICIO,</span>
<span class="s1">        fosfec09.fecdig AS FECHA_DIGITACION,</span>
<span class="s1">        fosfec09.fecsal AS FECHA_SALARIO,</span>
<span class="s1">        fosfec160.fecenv AS FECHA_ENVIO,</span>
<span class="s1">        fosfec160.fecterm AS FECHA_TERMINA_CONTRATO,</span>
<span class="s1">        fosfec160.salario AS ULTIMO_SALARIO,</span>
<span class="s1">        fosfec160.bonopen AS BONO_PENSIONAL,</span>
<span class="s1">        fosfec07.recsub AS RECIBE_SUBSIDIO,</span>
<span class="s1">        fosfec07.cuosub AS CUOTA_SUBSIDIO,</span>
<span class="s1">        fosfec160.numdaviplata AS NUMERO_DAVIPLATA,</span>
<span class="s1">        fosfec07.documento AS NUMERO_FORMULARIO,</span>
<span class="s1">        fosfec160.numres AS NUMERO_RESOLUCION,</span>
<span class="s1">        fosfec160.codcat AS CATEGORIA,</span>
<span class="s1">        fosfec160.codpen AS FONDO_PENSIONES,</span>
<span class="s1">        fosfec07.codces AS FONDO_CESANTIAS,</span>
<span class="s1">        fosfec160.codcaj AS CAJA_COMPENSACION</span>
<span class="s1">    FROM fosfec.fosfec160</span>
<span class="s1">    right JOIN fosfec.fosfec07 </span>
<span class="s1">        ON  fosfec.fosfec160.id = fosfec.fosfec07.id_web</span>
<span class="s1">    INNER JOIN fosfec.fosfec09 </span>
<span class="s1">        ON fosfec.fosfec07.cedtra = fosfec.fosfec09.cedtra</span>
<span class="s1">    WHERE DATE_FORMAT(fosfec160.fecsis, &#39;%Y%m%01&#39;) &gt;= DATE_SUB(CURDATE(), INTERVAL 18 MONTH)</span>
<span class="s1">    &#39;&#39;&#39;</span>
<span class="p">}</span>


<span class="n">df_structure</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;LECTURA DE QUERYS&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-23 14:50:24,330 - INFO - LECTURA DE QUERYS
</code></pre></div>

<h3 id="conexion-y-carga-de-tablas-desde-sql">Conexión y carga de tablas desde SQL<a class="headerlink" href="#conexion-y-carga-de-tablas-desde-sql" title="Permanent link">&para;</a></h3>
<p>Este código se conecta a la base de datos Minerva y carga las tablas especificadas en <code>qr_structure</code> utilizando SQL. Para cada tabla, el proceso de carga es registrado en el <code>logger</code>, y al final se registra el tiempo total que tomó cargar todas las tablas desde MySQL. Esto permite monitorear la ejecución y duración del proceso de carga de datos.</p>
<div class="highlight"><pre><span></span><code><span class="c1">#Conexion a base Minerva</span>
<span class="n">motor</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">obtener_conexion</span><span class="p">(</span><span class="s1">&#39;minerva&#39;</span><span class="p">))</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;CONEXION A BASE MINERVA&#39;</span><span class="p">)</span>
<span class="n">cargar_tablas</span><span class="p">(</span><span class="n">motor</span><span class="p">,</span> <span class="n">qr_structure</span><span class="p">,</span> <span class="n">df_structure</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-23 14:50:24,387 - INFO - CONEXION A BASE MINERVA
2024-10-23 14:50:24,696 - INFO - Cargando fact_foscec 
2024-10-23 14:50:26,609 - INFO - Cargada fact_foscec --- 1.91 seconds ---
2024-10-23 14:50:26,680 - INFO - CARGUE TABLAS DESDE MYSQL --- fact_foscec --- 2.29 seconds ---
</code></pre></div>

<h3 id="definicion-de-funciones-de-transformacion-y-limpieza">Definición de funciones de transformación y limpieza<a class="headerlink" href="#definicion-de-funciones-de-transformacion-y-limpieza" title="Permanent link">&para;</a></h3>
<p>Se define el identificador único <code>columId</code> como <code>'id'</code>, y se crea una lista llamada <code>ColumnsToCompare</code> que contiene las columnas clave del dataframe que se utilizarán en los procesos de transformación y limpieza. Estas columnas incluyen datos sobre fechas, salarios, documentos, y códigos. Esta lista es esencial para las operaciones posteriores, como la identificación de duplicados y la validación de datos.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Definición de funciones de transformación y limpieza</span>
<span class="n">columId</span> <span class="o">=</span> <span class="s1">&#39;REGISTRO_WEB&#39;</span>  <span class="c1"># Ajusta según tu identificador único</span>

<span class="c1"># Lista actualizada de columnas que cumplen con las restricciones</span>
<span class="n">ColumnsToCompare</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;REGISTRO_WEB&#39;</span><span class="p">,</span> <span class="s1">&#39;ID_AFILIADO&#39;</span><span class="p">,</span> <span class="s1">&#39;periodo&#39;</span><span class="p">,</span> <span class="s1">&#39;TIPO_DOCUMENTO&#39;</span><span class="p">,</span>
       <span class="s1">&#39;NUMERO_DOCUMENTO&#39;</span><span class="p">,</span> <span class="s1">&#39;FECHA_EXPEDICION_DOC&#39;</span><span class="p">,</span> <span class="s1">&#39;FECHA_SISTEMA&#39;</span><span class="p">,</span>
       <span class="s1">&#39;FECHA_ASIGNACION&#39;</span><span class="p">,</span> <span class="s1">&#39;FECHA_ESTADO&#39;</span><span class="p">,</span> <span class="s1">&#39;FECHA_NACIMIENTO&#39;</span><span class="p">,</span>
       <span class="s1">&#39;FECHA_FINAL_BENEFICIO&#39;</span><span class="p">,</span> <span class="s1">&#39;FECHA_DIGITACION&#39;</span><span class="p">,</span> <span class="s1">&#39;FECHA_SALARIO&#39;</span><span class="p">,</span>
       <span class="s1">&#39;FECHA_ENVIO&#39;</span><span class="p">,</span> <span class="s1">&#39;FECHA_TERMINA_CONTRATO&#39;</span><span class="p">,</span> <span class="s1">&#39;ULTIMO_SALARIO&#39;</span><span class="p">,</span>
       <span class="s1">&#39;BONO_PENSIONAL&#39;</span><span class="p">,</span> <span class="s1">&#39;RECIBE_SUBSIDIO&#39;</span><span class="p">,</span> <span class="s1">&#39;CUOTA_SUBSIDIO&#39;</span><span class="p">,</span>
       <span class="s1">&#39;NUMERO_DAVIPLATA&#39;</span><span class="p">,</span> <span class="s1">&#39;NUMERO_FORMULARIO&#39;</span><span class="p">,</span> <span class="s1">&#39;NUMERO_RESOLUCION&#39;</span><span class="p">,</span>
       <span class="s1">&#39;CATEGORIA&#39;</span><span class="p">,</span> <span class="s1">&#39;FONDO_PENSIONES&#39;</span><span class="p">,</span> <span class="s1">&#39;FONDO_CESANTIAS&#39;</span><span class="p">,</span> <span class="s1">&#39;CAJA_COMPENSACION&#39;</span>
<span class="p">]</span>
</code></pre></div>
<h3 id="proceso-de-limpieza-y-validacion-de-duplicados">Proceso de limpieza y validación de duplicados<a class="headerlink" href="#proceso-de-limpieza-y-validacion-de-duplicados" title="Permanent link">&para;</a></h3>
<p>Se itera sobre los dataframes en <code>df_structure</code>, guardando los duplicados mediante la función <code>StoreDuplicated</code> usando las columnas especificadas en <code>ColumnsToCompare</code>. Si la columna <code>f_disp_benef</code> está presente, se eliminan duplicados en función de esa fecha; en caso contrario, se omite esa operación y se registra una advertencia en el log. Posteriormente, se limpia el dataframe de errores utilizando la función <code>RemoveErrors</code>. Cada tabla procesada se registra en el log al completar la validación y limpieza de duplicados. </p>
<div class="highlight"><pre><span></span><code><span class="c1"># Iterar sobre los DataFrames para realizar transformaciones</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">df_structure</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Procesando tabla: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Guardar duplicados</span>
    <span class="n">StoreDuplicated</span><span class="p">(</span><span class="s1">&#39;N/A&#39;</span><span class="p">,</span> <span class="n">ColumnsToCompare</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="s1">&#39;duplicados_fact_fosfec_&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>

    <span class="c1"># Eliminar duplicados por fecha (asegúrate de tener una columna de fecha adecuada en tu DataFrame)</span>
    <span class="k">if</span> <span class="s1">&#39;FECHA_SISTEMA&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df_cleaned</span> <span class="o">=</span> <span class="n">RemoveDuplicated</span><span class="p">(</span><span class="n">columId</span><span class="p">,</span> <span class="s1">&#39;FECHA_SISTEMA&#39;</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Columna de fecha &quot;FECHA_SISTEMA&quot; no encontrada en </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">. Se omite la eliminación de duplicados por fecha.&#39;</span><span class="p">)</span>
        <span class="n">df_cleaned</span> <span class="o">=</span> <span class="n">df</span>

    <span class="c1"># Limpiar errores (si fuera aplicable a tu contexto)</span>
    <span class="n">df_final</span> <span class="o">=</span> <span class="n">RemoveErrors</span><span class="p">(</span><span class="n">df_cleaned</span><span class="p">,</span> <span class="s1">&#39;errores_fact_foscec_&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Proceso de limpieza y validación de duplicados completado para la tabla: &#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-23 14:50:26,776 - INFO - Proceso de limpieza y validación de duplicados completado para la tabla: fact_foscec


Procesando tabla: fact_foscec
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">df_structure</span><span class="p">[</span><span class="s1">&#39;fact_foscec&#39;</span><span class="p">]</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>REGISTRO_WEB</th>
      <th>ID_AFILIADO</th>
      <th>PERIODO</th>
      <th>TIPO_DOCUMENTO</th>
      <th>NUMERO_DOCUMENTO</th>
      <th>FECHA_EXPEDICION_DOC</th>
      <th>FECHA_SISTEMA</th>
      <th>FECHA_ASIGNACION</th>
      <th>FECHA_ESTADO</th>
      <th>FECHA_NACIMIENTO</th>
      <th>...</th>
      <th>BONO_PENSIONAL</th>
      <th>RECIBE_SUBSIDIO</th>
      <th>CUOTA_SUBSIDIO</th>
      <th>NUMERO_DAVIPLATA</th>
      <th>NUMERO_FORMULARIO</th>
      <th>NUMERO_RESOLUCION</th>
      <th>CATEGORIA</th>
      <th>FONDO_PENSIONES</th>
      <th>FONDO_CESANTIAS</th>
      <th>CAJA_COMPENSACION</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>27364</td>
      <td>CC1082953354</td>
      <td>202305</td>
      <td>CC</td>
      <td>1082953354</td>
      <td>2010-08-02</td>
      <td>2023-05-15</td>
      <td>None</td>
      <td>2023-05-31</td>
      <td>1992-01-14</td>
      <td>...</td>
      <td>N</td>
      <td>N</td>
      <td>0</td>
      <td>3002387992</td>
      <td>0006409</td>
      <td>1</td>
      <td>A</td>
      <td>230301</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>27549</td>
      <td>CC85472991</td>
      <td>202306</td>
      <td>CC</td>
      <td>85472991</td>
      <td>1994-02-07</td>
      <td>2023-06-06</td>
      <td>2021-10-21</td>
      <td>2023-07-17</td>
      <td>1975-08-08</td>
      <td>...</td>
      <td>N</td>
      <td>N</td>
      <td>0</td>
      <td>3107270027</td>
      <td>0015707</td>
      <td>1</td>
      <td>B</td>
      <td>25-14</td>
      <td>SINAFP</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>30246</td>
      <td>CC57466051</td>
      <td>202401</td>
      <td>CC</td>
      <td>57466051</td>
      <td>2003-12-10</td>
      <td>2024-01-09</td>
      <td>2022-08-24</td>
      <td>2024-01-23</td>
      <td>1985-06-20</td>
      <td>...</td>
      <td>N</td>
      <td>S</td>
      <td>1</td>
      <td>3016669725</td>
      <td>0015772</td>
      <td>1</td>
      <td>A</td>
      <td>25-14</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>33874</td>
      <td>CC57463242</td>
      <td>202409</td>
      <td>CC</td>
      <td>57463242</td>
      <td>2003-03-25</td>
      <td>2024-09-10</td>
      <td>2022-08-24</td>
      <td>2024-09-16</td>
      <td>1981-12-29</td>
      <td>...</td>
      <td>N</td>
      <td>S</td>
      <td>1</td>
      <td>3145915729</td>
      <td>0015831</td>
      <td>1</td>
      <td>A</td>
      <td>230301</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>28163</td>
      <td>CC1082936727</td>
      <td>202307</td>
      <td>CC</td>
      <td>1082936727</td>
      <td>2009-08-12</td>
      <td>2023-07-17</td>
      <td>2022-08-24</td>
      <td>2022-09-16</td>
      <td>1991-06-27</td>
      <td>...</td>
      <td>N</td>
      <td>S</td>
      <td>2</td>
      <td>3005083755</td>
      <td>0015847</td>
      <td>1</td>
      <td>A</td>
      <td>230301</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>6985</th>
      <td>34167</td>
      <td>CC57296404</td>
      <td>202410</td>
      <td>CC</td>
      <td>57296404</td>
      <td>2001-10-26</td>
      <td>2024-10-03</td>
      <td>None</td>
      <td>2024-10-18</td>
      <td>1982-08-20</td>
      <td>...</td>
      <td>N</td>
      <td>N</td>
      <td>0</td>
      <td>3008079311</td>
      <td>0026121</td>
      <td>1</td>
      <td>A</td>
      <td>25-14</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6986</th>
      <td>34168</td>
      <td>CC1079934467</td>
      <td>202410</td>
      <td>CC</td>
      <td>1079934467</td>
      <td>2010-06-17</td>
      <td>2024-10-04</td>
      <td>None</td>
      <td>2024-10-18</td>
      <td>1992-05-24</td>
      <td>...</td>
      <td>N</td>
      <td>N</td>
      <td>0</td>
      <td>3235958060</td>
      <td>0026122</td>
      <td>1</td>
      <td>A</td>
      <td>230301</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6987</th>
      <td>34218</td>
      <td>CC39049304</td>
      <td>202410</td>
      <td>CC</td>
      <td>39049304</td>
      <td>1998-03-19</td>
      <td>2024-10-01</td>
      <td>None</td>
      <td>2024-10-18</td>
      <td>1979-08-29</td>
      <td>...</td>
      <td>N</td>
      <td>N</td>
      <td>0</td>
      <td>3012678558</td>
      <td>0026123</td>
      <td>1</td>
      <td>A</td>
      <td>230301</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6988</th>
      <td>34219</td>
      <td>CC1221981251</td>
      <td>202410</td>
      <td>CC</td>
      <td>1221981251</td>
      <td>2017-07-04</td>
      <td>2024-10-04</td>
      <td>None</td>
      <td>2024-10-18</td>
      <td>1999-04-25</td>
      <td>...</td>
      <td>N</td>
      <td>S</td>
      <td>1</td>
      <td>3042234766</td>
      <td>0026124</td>
      <td>1</td>
      <td>A</td>
      <td>230301</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6989</th>
      <td>34259</td>
      <td>CC85260916</td>
      <td>202410</td>
      <td>CC</td>
      <td>85260916</td>
      <td>2001-01-08</td>
      <td>2024-10-08</td>
      <td>None</td>
      <td>2024-10-18</td>
      <td>1982-09-04</td>
      <td>...</td>
      <td>N</td>
      <td>N</td>
      <td>0</td>
      <td>3234251547</td>
      <td>0026125</td>
      <td>1</td>
      <td>A</td>
      <td>230201</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
<p>6990 rows × 26 columns</p>
</div>

<h3 id="guardar-en-la-base-de-datos-dwh">Guardar en la base de datos DWH<a class="headerlink" href="#guardar-en-la-base-de-datos-dwh" title="Permanent link">&para;</a></h3>
<p>Se guarda el dataframe <code>fact_foscec</code> en la tabla <code>BD_FactFosfec</code> de la base de datos DWH. Si la tabla ya existe, se reemplaza con los nuevos datos. El tiempo total de almacenamiento se registra en el log, seguido del registro de finalización del proceso ETL, incluyendo el tiempo total desde el inicio del proceso.</p>
<div class="highlight"><pre><span></span><code><span class="n">guardar_en_dwh</span><span class="p">(</span><span class="n">df_structure</span><span class="p">[</span><span class="s1">&#39;fact_foscec&#39;</span><span class="p">],</span> <span class="s1">&#39;BD_Fact_Fosfec&#39;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-23 14:50:26,814 - INFO - Intentando conexión a la base DWH...
2024-10-23 14:50:26,816 - INFO - Conexión a la base DWH establecida con éxito.
2024-10-23 14:50:27,120 - INFO - Almacenando tabla única en DWH como BD_Fact_Fosfec
2024-10-23 14:50:29,773 - INFO - Tabla almacenada correctamente.
2024-10-23 14:50:29,852 - INFO - ALMACENAMIENTO ---  --- 3.04 seconds ---
2024-10-23 14:50:29,853 - INFO - Finalizando proceso de almacenamiento en DWH.
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Tiempo total de ejecución</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;FINAL ETL --- </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> seconds ---&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>2024-10-23 14:50:29,863 - INFO - FINAL ETL --- 5.54 seconds ---
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../js/init_mermaid.js"></script>
      
    
  </body>
</html>